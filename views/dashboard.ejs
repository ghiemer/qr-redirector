<%- include('layout-header') %>
<style>
  .qr-container {
    text-align: center;
  }
  .qr-downloads {
    margin-top: 5px;
  }
  .qr-downloads a {
    font-size: 11px;
    margin: 0 3px;
    padding: 2px 6px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 3px;
    text-decoration: none;
    color: #495057;
  }
  .qr-downloads a:hover {
    background: #e9ecef;
  }
  .short-url {
    font-family: monospace;
    font-size: 12px;
    color: #666;
  }
  .navigation {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  .navigation a {
    margin-right: 15px;
    text-decoration: none;
    color: #007bff;
  }
  .navigation a:hover {
    text-decoration: underline;
  }
  .navigation a.active {
    font-weight: bold;
    color: #495057;
  }
</style>

<div class="navigation">
  <a href="/admin/dashboard" class="active">📊 Dashboard</a>
  <a href="/admin/routes/new">➕ Neue Route</a>
  <a href="/admin/settings">⚙️ Einstellungen</a>
  <a href="#" onclick="logout()">🚪 Logout</a>
</div>

<h1>Routenübersicht</h1>
<a class="btn" href="/admin/routes/new">+ Neue Route</a>
<table>
  <thead>
    <tr>
      <th>Alias</th>
      <th>Kurz-URL</th>
      <th>Ziel-URL</th>
      <th>Status</th>
      <th>Statistiken</th>
      <th>QR-Code</th>
      <th>Aktionen</th>
    </tr>
  </thead>
  <% routes.forEach(r => { %>
  <tr>
    <td><strong><%= r.alias %></strong></td>
    <td><span class="short-url"><%= r.shortUrl %></span></td>
    <td><%= r.fullUrl %></td>
    <td><%= r.active ? "✅" : "❌" %></td>
    <td class="stats-container">
      <% if (process.env.CLICK_COUNTER_ENABLED === 'true' && r.stats) { %>
        <div class="click-stats">
          <strong>📊 <%= r.stats.total %></strong> gesamt<br>
          <span class="stat-details">
            👤 <%= r.stats.unique %> eindeutig<br>
            📅 <%= r.stats.today %> heute
          </span>
        </div>
      <% } else { %>
        <div class="no-stats">
          📊 Counter deaktiviert
        </div>
      <% } %>
    </td>
    <td class="qr-container">
      <img src="<%= r.qrPngUrl %>" width="120" title="QR-Code für <%= r.fullUrl %>"><br>
      <div class="qr-downloads">
        <a href="<%= r.qrPngUrl %>" download="<%= r.alias %>-qr.png">PNG</a>
        <a href="<%= r.qrSvgUrl %>" download="<%= r.alias %>-qr.svg">SVG</a>
      </div>
    </td>
    <td>
      <a class="btn" href="/admin/routes/edit/<%= r.id %>">Bearbeiten</a>
      <a class="btn delete-btn" href="/admin/routes/delete/<%= r.id %>">Löschen</a>
    </td>
  </tr>
  <% }) %>
</table>

<script>
function logout() {
  if (confirm('Möchtest du dich wirklich abmelden?')) {
    fetch('/admin/logout', { method: 'POST' })
      .then(() => window.location.href = '/admin/login');
  }
}
</script>

<%- include('layout-footer') %>
